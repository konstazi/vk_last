# Домашнее задание 7
## Основы безопасности инфраструктуры
### 1. Захаркоженные секреты
> [!CAUTION]
> В нашем playbook есть два жестко заданных секрета. Они находятся в строчках:  
```yaml
app_password: "Sup3rS3cr3tP@ssw0rd123"
```  
```yaml 
<p>Your secret token: {{ secret_token.stdout }}</p>
```  
> [!WARNING]
> Хранение захардкоженных конфиденциальных данных в системе контроля версий недопустимо, т.к. это приведет к их компрометации пользователем, у которого есть доступ к этому репозиторию. Даже при условии, что репозиторий является частным, это все равно риск утечки паролей и токенов, например, из-за скомпроментированной учетной записи разработчика или неправильных разграничительных конфигураций.

> [!IMPORTANT]
> Для предотвращения данной уязвимости следует использовать *Ansible Vault* или внешнее хранилище.
### 2. Брандмауэр
> [!CAUTION]
> Существуют риски, связанные с отключением брандмауэра (```ufw disable```) и подавленим ошибок (```ignore_errors:yes```).

> [!WARNING]
> Отключение брандмаура открывает систему для всех входящих подключений. Злоумышленники могут легко сканировать нашу систему на наличие открытых портов и уязвимостей. При работе сервиса с известными уязвимостятми, их можно будет эксплуатировать.

> [!IMPORTANT]
> Вместо полного отключения следует настроить МЭ так, чтобы он разрещал только необходимый трафик. Необходимо разрешить соединение только на те порты, которые используются сервиса и к которым доступ необходим. Также важно ограничить доступ путем составления белого списка IP-адресов.

> [!WARNING]
> Намеренно подавление ошибок опасно тем, что мы не будем узнавать о том, что происходит в нашей системе. У нас будут неправильно функционировать важные службы и сервисы, а из-за игнорирования ошибок будет труднее производить отладку и поиск мисконфигураций, которые могут привести к печальным последствиям.

> [!IMPORTANT]
> Для избежания данной проблемы следует использовать функции ```block``` и ```rescue```, которые позволяют обрабатывать ошибки в плейбуках.
### 3. Контрольная сумма
> [!CAUTION]
> При загрузке архива отсутсвует проверка контрольной суммы. Это находится в строчке:  
```yaml
url: "{{ download_url }}"
```  
> [!WARNING]
> При таком подходе существует риск, что загруженный файл будет поврежден или подменен. В результате, у нас будет развернуто вредоносное приложение.

> [!IMPORTANT]
> В качестве противодействия следует использовать ```checksum```, которое будет проверять ожидаемый дайджест. При неверном хеш-значении будет отправляться соответсвующее уведомление.

![check](https://github.com/user-attachments/assets/85c56a85-accb-435b-a9a5-06876d9e1c6e)
### 4. Устаревший образ
> [!CAUTION]
> Используемые образы устарели.

> [!WARNING]
> Использование устаревших образов ПО (в нашем случае *nginx*) похволяет злоумышленникам использовать известные уязвимости. Также это может приводить ошибкам в совместимости.

> [!IMPORTANT]
> Необходимо производить автоматическое сканирование образов с помощью различных инструментов, например, *Clair*. Это можно реализовать с помощью интеграции в CI/CD пайплайны. Помимо этого следует использовать последнии версии ПО, которые уже выпущены в релиз (не бета-версии).

> [!NOTE]
> Список найденных уязвимостей для *nginx* версии 1.18.0 можно посмотреть [здесь](https://www.cybersecurity-help.cz/vdb/nginx/nginx/1.18.0/).
### 5. Разграничение доступа
> [!CAUTION]
> Присутсвуют мисконфигурации в приложении.

> [!WARNING]
> Предоставление прав **777** на рабочую директорию подразумевает выполенение любых действий (<ins>чтение</ins>, <ins>запись</ins> и <ins>выполнение</ins>) для любых пользователей (<ins>владельца</ins>, <ins>рабочей группы</ins> и <ins>остальных</ins>). Это приводит к различным атакам, например, внедрение вредоносного кода от лица любого пользователя.

> [!IMPORTANT]
> Необходимо руководствоваться ***принципом минимальных привелегий***, т.е. предоставлять необходимые права только тем пользователям, которым они необходимы для выполенения их рабочих задач.

### 6. Личный токен 
> [!CAUTION]
> При разврертывании приложения и переходе на ```localhost:8080``` у нас выводится личный токен.  

![token](https://github.com/user-attachments/assets/8bd15ee9-e02e-4e0f-9744-96256b282064)  
> [!WARNING]
> Любой кто откроет страницу увидит данный токен, который расположен в **index.html**.

> [!IMPORTANT]
> Для этого необходимо запретить вход неавторизированному пользователю. Также, как упоминалось ранее, секреты не должны храниться в коде и нужно использовать переменные окружения.

С помощью инструмента *ansible-lint* был произведен анализ нашего playbook.  
![lint](https://github.com/user-attachments/assets/44e10e62-efb5-4d72-ba7c-f08d6fd50929)
