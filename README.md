# vk_last
Основы безопасности инфраструктуры
1. В нашем playbook есть два жестко заданных секрета. Они находятся в строчках:  
   app_password: "Sup3rS3cr3tP@ssw0rd123"  
   <p>Your secret token: {{ secret_token.stdout }}</p>
   Хранение захардкоженных конфиденциальных данных в системе контроля версий недопустимо, т.к. это приведет к их компрометации пользователем, у которого есть доступ к этому репозиторию. Даже при условии, что репозиторий является частным, это все равно риск утечки паролей и токенов, например, из-за скомпроментированной учетной записи разработчика или неправильных разграничительных конфигураций.  
   Для предотвращения данной уязвимости следует использовать Ansible Vault или внешнее хранилище.
3. Существуют риски, связанные с отключением брандмауэра (ufw disable) и подавленим ошибок (ignore_errors:yes).  
   Отключение брандмаура открывает систему для всех входящих подключений. Злоумышленники могут легко сканировать нашу систему на наличие открытых портов и уязвимостей. При работе сервиса с известными уязвимостятми, их можно будет эксплуатировать.  
   Вместо полного отключения следует настроить МЭ так, чтобы он разрещал только необходимый трафик. Необходимо разрешить соединение только на те порты, которые используются сервиса и к которым доступ необходим. Также важно ограничить доступ путем составления белого списка IP-адресов.  
   Намеренно подавление ошибок опасно тем, что мы не будем узнавать о том, что происходит в нашей системе. У нас будут неправильно функционировать важные службы и сервисы, а из-за игнорирования ошибок будет труднее производить отладку и поиск мисконфигураций, которые могут привести к печальным последствиям.  
   Для избежания данной проблемы следует использовать функции block и rescue, которые позволяют обрабатывать ошибки в плейбуках.
4. При загрузке архива отсутсвует проверка контрольной суммы. Это находится в строчке:  
   url: "{{ download_url }}"
   При таком подходе существует риск, что загруженный файл будет поврежден или подменен. В результате, у нас будет развернуто вредоносное приложение.
   В качестве противодействия следует использовать checksum, которое будет проверять ожидаемый дайджест. При неверном хеш-значении будет отправляться соответсвующее уведомление.
6. Использование устаревших образов ПО (в нашем случае nginx) похволяет злоумышленникам использовать известные уязвимости. Также это может приводить ошибкам в совместимости.
   Необходимо производить автоматическое сканирование образов с помощью различных инструментов, например, Clair. Это можно реализовать с помощью интеграции в CI/CD пайплайны.
   Помимо этого следует использовать последнии версии ПО, которые уже выпущены в релиз (не бета-версии).
7. Предоставление прав 777 на рабочую директорию подразумевает выполенение любых действий (чтение, запись и выполнение) для любых пользователей (владельца, рабочей группы и остальных). Это приводит к различным атакам, например, внедрение вредоносного кода от лица любого пользователя.
   Необходимо руководствоваться принципом минимальных привелегий, т.е. предоставлять необходимые права только тем пользователям, которым они необходимы для выполенения их рабочих задач.
8. При разврертывании приложения и переходе на localhost:8080 у нас выводится личный токен.
   ![token](https://github.com/user-attachments/assets/8bd15ee9-e02e-4e0f-9744-96256b282064)  
   Любой кто откроет страницу увидит данный токен, который расположен в index.html. Для этого необходимо запретить вход неавторизированному пользователю. Также, как упоминалось ранее, секреты не должны храниться в коде и нужно использовать переменные окружения.
   С помощью инструмента ansible-lint был произведен анализ нашего playbook.  
   ![lint](https://github.com/user-attachments/assets/44e10e62-efb5-4d72-ba7c-f08d6fd50929)

